<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>맛집 목록 | FoodieHub</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

    <!-- 공통 헤더 -->
    <div th:replace="~{layout/header :: header}"></div>

    <main class="restaurant-page">

        <!-- 검색창 -->
        <div class="restaurant-search">
            <form th:action="@{/restaurant/list}" method="get">
                <input type="text" name="keyword" placeholder="맛집 이름을 검색하세요" th:value="${keyword}">
                <button type="submit" class="btn">검색</button>
                <a th:href="@{/restaurant/list}" class="reset-btn">초기화</a>
            </form>
        </div>

        
        <!-- 검색 결과 총 개수 -->
        <div class="result-count" th:if="${totalCount > 0}">
            총 <span th:text="${totalCount}">0</span>개의 맛집이 검색되었습니다.
        </div>
        <div class="result-count" th:if="${totalCount == 0}">
            검색 결과가 없습니다.
        </div>
        

        <!-- 메인 컨테이너 -->
        <div class="restaurant-container-row">

            <!-- 필터 영역 -->
            <div class="filter-bar-row">
                
                <!-- 음식 필터 -->
                <div class="filter-box">
                    <div class="filter-header-single">
                        <a th:href="@{/restaurant/list(regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}">음식</a>
                    </div>
                    <div class="filter-body-single">
                        <a th:href="@{/restaurant/list(category='한식', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '한식' ? 'active' : ''">한식</a>
                        <a th:href="@{/restaurant/list(category='중식', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '중식' ? 'active' : ''">중식</a>
                        <a th:href="@{/restaurant/list(category='일식', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '일식' ? 'active' : ''">일식</a>
                        <a th:href="@{/restaurant/list(category='양식', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '양식' ? 'active' : ''">양식</a>
                        <a th:href="@{/restaurant/list(category='분식', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '분식' ? 'active' : ''">분식</a>
                        <a th:href="@{/restaurant/list(category='패스트푸드', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '패스트푸드' ? 'active' : ''">패스트푸드</a>
                        <a th:href="@{/restaurant/list(category='카페', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '카페' ? 'active' : ''">카페</a>
                        <a th:href="@{/restaurant/list(category='디저트', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '디저트' ? 'active' : ''">디저트</a>
                        <a th:href="@{/restaurant/list(category='고기', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '고기' ? 'active' : ''">고기</a>
                        <a th:href="@{/restaurant/list(category='해산물', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '해산물' ? 'active' : ''">해산물</a>
                        <a th:href="@{/restaurant/list(category='술집', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '술집' ? 'active' : ''">술집</a>
                        <a th:href="@{/restaurant/list(category='기타', regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, keyword=${keyword})}" th:classappend="${category} == '기타' ? 'active' : ''">기타</a>
                    </div>
                </div>

                
                <!-- 지역 필터 (1단계: 시/도) -->
                <div class="filter-box">
                    <div class="filter-header-single">
                        <a th:href="@{/restaurant/list(category=${category}, keyword=${keyword})}">지역</a>
                    </div>
                    <div class="filter-body-single">
                        <a href="javascript:void(0)" onclick="selectCity('서울')" th:classappend="${regionLevel1} == '서울' ? 'active' : ''">서울</a>
                        <a href="javascript:void(0)" onclick="selectCity('부산')" th:classappend="${regionLevel1} == '부산' ? 'active' : ''">부산</a>
                        <a href="javascript:void(0)" onclick="selectCity('대구')" th:classappend="${regionLevel1} == '대구' ? 'active' : ''">대구</a>
                        <a href="javascript:void(0)" onclick="selectCity('인천')" th:classappend="${regionLevel1} == '인천' ? 'active' : ''">인천</a>
                        <a href="javascript:void(0)" onclick="selectCity('광주')" th:classappend="${regionLevel1} == '광주' ? 'active' : ''">광주</a>
                        <a href="javascript:void(0)" onclick="selectCity('대전')" th:classappend="${regionLevel1} == '대전' ? 'active' : ''">대전</a>
                        <a href="javascript:void(0)" onclick="selectCity('울산')" th:classappend="${regionLevel1} == '울산' ? 'active' : ''">울산</a>
                        <a href="javascript:void(0)" onclick="selectCity('세종')" th:classappend="${regionLevel1} == '세종' ? 'active' : ''">세종</a>
                        <a href="javascript:void(0)" onclick="selectCity('경기')" th:classappend="${regionLevel1} == '경기' ? 'active' : ''">경기</a>
                        <a href="javascript:void(0)" onclick="selectCity('강원')" th:classappend="${regionLevel1} == '강원' ? 'active' : ''">강원</a>
                        <a href="javascript:void(0)" onclick="selectCity('충북')" th:classappend="${regionLevel1} == '충북' ? 'active' : ''">충북</a>
                        <a href="javascript:void(0)" onclick="selectCity('충남')" th:classappend="${regionLevel1} == '충남' ? 'active' : ''">충남</a>
                        <a href="javascript:void(0)" onclick="selectCity('전북')" th:classappend="${regionLevel1} == '전북' ? 'active' : ''">전북</a>
                        <a href="javascript:void(0)" onclick="selectCity('전남')" th:classappend="${regionLevel1} == '전남' ? 'active' : ''">전남</a>
                        <a href="javascript:void(0)" onclick="selectCity('경북')" th:classappend="${regionLevel1} == '경북' ? 'active' : ''">경북</a>
                        <a href="javascript:void(0)" onclick="selectCity('경남')" th:classappend="${regionLevel1} == '경남' ? 'active' : ''">경남</a>
                        <a href="javascript:void(0)" onclick="selectCity('제주')" th:classappend="${regionLevel1} == '제주' ? 'active' : ''">제주</a>
                        <a th:href="@{/restaurant/list(regionLevel1='기타', category=${category}, keyword=${keyword})}" th:classappend="${regionLevel1} == '기타' ? 'active' : ''">기타</a>
                    </div>
                </div>

                <!-- 지역 필터 (2단계: 구/군) -->
                <div class="filter-box" id="district-filter-box" style="display:none;">
                    <div class="filter-header-single">
                        <a href="javascript:void(0)" onclick="clearDistrict()">상세 지역</a>
                    </div>
                    <div class="filter-body-single" id="district-filter-body">
                        <!-- JS로 생성 -->
                    </div>
                </div>
            </div>

            <!-- 오른쪽 리스트 -->
            <section class="restaurant-list">
                <div th:if="${#lists.isEmpty(restaurants)}" class="no-result">
                    <p>검색 결과가 없습니다.</p>
                </div>

                <div class="restaurant-item" th:each="r : ${restaurants}">
                    <a th:href="@{'/restaurant/detail/' + ${r.id}}" class="restaurant-link">
                        <img th:src="${r.mainImageUrl}" alt="thumbnail" onerror="this.src='/images/default-thumbnail.png'">
                        <div class="restaurant-info">
                            <h4 th:text="${r.name}">식당 이름</h4>
                            <p th:text="'★ ' + ${r.avgRating} + ' | ' + ${r.category} + ' | ' + ${r.regionLevel1}"></p>
                            <p th:text="${r.address}"></p>
                        </div>
                    </a>
                </div>
                
                <!-- 페이지네이션 -->
                <div class="pagination">
                    <a th:if="${currentPage > 1}" th:href="@{/restaurant/list(regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, category=${category}, keyword=${keyword}, page=${currentPage - 1})}">« 이전</a>
                    <span th:text="${currentPage}"></span>
                    <a th:if="${currentPage < totalPages}" th:href="@{/restaurant/list(regionLevel1=${regionLevel1}, regionLevel2=${regionLevel2}, category=${category}, keyword=${keyword}, page=${currentPage + 1})}">다음 »</a>
                </div>
                
            </section>
        </div>
    </main>

    <!-- 공통 푸터 -->
    <div th:replace="~{layout/footer :: footer}"></div>
    
    <script th:inline="javascript">
	    window.regionLevel1 = /*[[${regionLevel1}]]*/ null;
	    window.regionLevel2 = /*[[${regionLevel2}]]*/ null;
	    window.category = /*[[${category}]]*/ null;
	    window.keyword = /*[[${keyword}]]*/ null;
	</script>

	<script th:src="@{/js/restaurant-list.js}"></script>
</body>
</html>
