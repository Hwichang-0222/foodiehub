<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>식당 수정 | FoodieHub</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- 헤더 -->
    <div th:replace="layout/header :: header"></div>
    
    <!-- 식당 수정 메인 영역 -->
    <main class="signup-main">
        <section class="signup-container">
            <button type="button" class="btn-back-nav" onclick="history.back()">← 뒤로가기</button>
            <h2>식당 정보 수정</h2>

            <form th:action="@{/restaurant/edit/{id}(id=${restaurant.id})}" 
                  method="post" 
                  enctype="multipart/form-data"
                  class="restaurant-form">

            <!-- [1] 식당명 (읽기전용) -->
            <label>식당명</label>
            <input type="text" th:value="${restaurant.name}" name="name" readonly>

            <!-- [2] 주소 검색 -->
            <label>주소 검색</label>
            <div class="search-group">
                <input type="text" id="addressSearch" placeholder="수정할 주소를 입력하세요">
                <button type="button" class="btn" onclick="searchAddress()">검색</button>
            </div>
            <ul id="resultList" class="search-result"></ul>

            <!-- [3] 주소 -->
            <label>주소</label>
            <input type="text" id="address" name="address" th:value="${restaurant.address}" readonly required>

            <!-- [4] 지역 (읽기전용) -->
            <label>지역</label>
            <input type="text" th:value="${restaurant.regionLevel1}" name="regionLevel1" readonly>
            <input type="hidden" id="regionLevel2" name="regionLevel2" th:value="${restaurant.regionLevel2}">
			<input type="hidden" id="regionLevel3" name="regionLevel3" th:value="${restaurant.regionLevel3}">

            <!-- [5] 카테고리 (읽기전용) -->
			<label>카테고리</label>
            <input type="text" th:value="${restaurant.category}" name="category" readonly>

            <!-- [6] 설명 (수정 가능) -->
            <label>설명</label>
            <textarea name="description" rows="4" placeholder="식당 설명을 입력하세요" th:text="${restaurant.description}"></textarea>

            <!-- [7] 대표 이미지 (수정 가능) -->
            <label>대표 이미지</label>
            <input type="file" id="mainImage" name="mainImage" accept="image/*">
            <small>* 새 이미지를 선택하지 않으면 기존 이미지가 유지됩니다.</small>

            <!-- [8] 이미지 미리보기 -->
            <div id="preview-container">
                <img id="preview" th:src="${restaurant.mainImageUrl}" alt="미리보기" style="display:block;">
            </div>

            <!-- [9] 위도 / 경도 (자동 업데이트) -->
            <label>위도</label>
            <input type="text" id="latitude" name="latitude" th:value="${restaurant.latitude}" readonly>

            <label>경도</label>
            <input type="text" id="longitude" name="longitude" th:value="${restaurant.longitude}" readonly>

            <!-- [10] 지도 표시 -->
            <div id="map"></div>

            <!-- [11] 버튼 -->
            <div class="form-actions">
                <button type="submit" class="btn btn-create">수정</button>
                <a th:href="@{/restaurant/detail/{id}(id=${restaurant.id})}" class="btn cancel-btn">취소</a>
            </div>
        </form>
        </section>
    </main>

    <!-- 푸터 -->
    <div th:replace="layout/footer :: footer"></div>

	<!-- 카카오 지도 SDK (API 키는 application.properties에서 주입) -->
	<script th:src="'https://dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${kakaoMapApiKey} + '&libraries=services'"></script>

	<!-- 식당 추가/수정 페이지 통합 JavaScript -->
	<script src="/js/restaurant-form.js"></script>
</body>
</html>