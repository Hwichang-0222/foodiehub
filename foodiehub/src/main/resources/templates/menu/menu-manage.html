<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>메뉴 관리</title>
    <link rel="stylesheet" th:href="@{/css/modal.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<!-- 로그인 상태 및 역할 전달 (JavaScript에서 사용) -->
	<input type="hidden" id="userLoggedIn" th:value="${user != null}">
	<input type="hidden" id="userRole" th:value="${user != null ? user.role : ''}">
	
    <!-- 공통 헤더 -->
    <div th:replace="layout/header :: header"></div>

	<div class="page-header">
	    <button onclick="history.back()" class="btn-back-nav">← 뒤로가기</button>
	    <h2>메뉴 관리</h2>
	</div>
	
	<div class="menu-manage-container">
	
	    <!-- ▣ 메뉴판 이미지 영역 -->
	    <div class="menu-image-section">
	        <h2>메뉴판 이미지</h2>
	
	        <div class="menu-image-list">
			    <!-- div wrapper로 감싸고 삭제 버튼 추가 -->
			    <div th:each="img : ${menuImages}" 
			         th:id="'menuImg-' + ${img.id}"
			         class="menu-image-wrapper">
			        <img th:src="${img.imageUrl}"
			             class="menu-image-thumb"
			             onclick="openImageModal(this.src)"
			             onerror="this.src='/images/default-menu-thumbnail.png'">
			        <button class="btn btn-danger" 
			                th:onclick="'deleteMenuImage(' + ${img.id} + ')'">삭제</button>
			    </div>
			</div>
	
	        <!-- 메뉴판 이미지 업로드 -->
	        <form id="menuImageUploadForm" enctype="multipart/form-data">
	            <input type="hidden" name="restaurantId" th:value="${restaurantId}">
	            <label>이미지 선택</label>
	            <input type="file" name="file" accept="image/*" onchange="previewMenuImage(event)">
	            <img id="menuImagePreview" class="preview">
	            <button type="submit" class="btn btn-create">이미지 추가</button>
	        </form>
	    </div>
	
	    <hr>
	
	    <!-- ▣ 메뉴 목록 테이블 -->
	    <div>
	        <h2>메뉴 목록</h2>
	
	        <table class="menu-table">
	            <thead>
	            <tr>
	                <th>메뉴명</th>
	                <th>설명</th>
	                <th>가격</th>
	                <th>수정</th>
	                <th>삭제</th>
	            </tr>
	            </thead>
	
	            <tbody id="menuTableBody">
	            <tr th:each="m : ${menus}" 
	                th:id="'menuRow-' + ${m.id}"
	                th:data-menu-id="${m.id}"
	                th:data-menu-name="${m.name}"
	                th:data-menu-price="${m.price}"
	                th:data-menu-description="${m.description}">
	                <td th:text="${m.name}"></td>
	                <td th:text="${m.description}"></td>
	                <td th:text="${m.price}"></td>
	                <td><button th:onclick="'openEditMenu(' + ${m.id} + ')'" class="btn">수정</button></td>
	                <td><button th:onclick="'deleteMenu(' + ${m.id} + ')'" class="btn btn-danger">삭제</button></td>
	            </tr>
	            </tbody>
	        </table>
	    </div>
	
	    <hr>
	
	    <!-- ▣ 메뉴 추가 폼 -->
	    <div class="menu-add-section">
	        <h2>메뉴 추가</h2>
	
	        <form id="addMenuForm">
	            <input type="hidden" name="restaurantId" th:value="${restaurantId}">
	
	            <div class="form-field">
	                <label>메뉴명</label>
	                <input type="text" name="name" required>
	            </div>
	
	            <div class="form-field">
	                <label>설명</label>
	                <textarea name="description" rows="1"></textarea>
	            </div>
	
	            <div class="form-field">
	                <label>가격</label>
	                <input type="number" name="price" required>
	            </div>
	
	            <button type="submit" class="btn btn-create">추가</button>
	        </form>
	    </div>
	
	    <!-- ▣ 완료 버튼 영역 -->
	    <div class="menu-complete-section">
	        <input type="hidden" id="restaurantId" th:value="${restaurantId}">
	        <button type="button" class="btn-complete" onclick="completeMenuManage()">완료</button>
	    </div>
	
	</div>

    <!-- 메뉴 수정 모달 -->
    <div id="editMenuModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>메뉴 수정</h3>
                <button type="button" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editMenuForm">
                    <input type="hidden" name="id" id="editMenuId">
                    <input type="hidden" name="restaurantId" th:value="${restaurantId}">
                    
                    <div class="form-group">
                        <label class="form-label">메뉴명</label>
                        <input type="text" name="name" id="editMenuName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">설명</label>
                        <textarea name="description" id="editMenuDescription" class="form-control form-textarea" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">가격</label>
                        <input type="number" name="price" id="editMenuPrice" class="form-control" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-submit">수정</button>
                        <button type="button" class="btn-cancel">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 이미지 미리보기 모달 -->
    <div id="imagePreviewModal" class="modal">
        <div class="modal-content" style="max-width: 90%; background: transparent; box-shadow: none;">
            <div class="modal-header" style="border: none; padding: 10px; justify-content: flex-end;">
                <button type="button" class="modal-close" style="font-size: 40px; color: white;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0; text-align: center;">
                <img id="previewImage" src="" style="max-width: 100%; max-height: 80vh; border-radius: 8px;">
            </div>
        </div>
    </div>

    <!-- 공통 푸터 -->
    <div th:replace="layout/footer :: footer"></div>

<script src="/js/menu-manage.js"></script>

</body>
</html>