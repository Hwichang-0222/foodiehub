<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원정보 수정 | FoodieHub</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <!-- 공통 주소/지역 JS -->
    <script th:src="@{/js/user-address.js}" defer></script>

    <!-- 회원정보 수정 전용 validation -->
    <script th:src="@{/js/edit-validation.js}" defer></script>
</head>
<body>

    <!-- 공통 헤더 -->
    <div th:replace="layout/header :: header"></div>

    <main class="signup-main">
        <section class="signup-container">
            <button type="button" class="btn-back-nav" onclick="history.back()">← 뒤로가기</button>
            <h2>회원정보 수정</h2>

            <!-- ============================================
                 SNS 로그인 배지 표시
            ============================================ -->
            <div th:if="${user.provider != null}" class="account-badge" 
                 th:classappend="${user.provider == 'kakao' ? 'badge-kakao' : 'badge-naver'}">
                <img th:if="${user.provider == 'kakao'}" 
                     th:src="@{/images/kakao-logo.png}" 
                     alt="카카오" class="badge-logo">
                <img th:if="${user.provider == 'naver'}" 
                     th:src="@{/images/naver-logo.png}" 
                     alt="네이버" class="badge-logo">
                <span th:text="${user.provider == 'kakao' ? '카카오' : '네이버'}"></span> 계정으로 연동됨
            </div>

            <form th:action="@{/user/update}" method="post" 
                  th:object="${user}" enctype="multipart/form-data" id="signupForm">

                <!-- ============================================
                     비밀번호 필드 (일반 로그인만)
                ============================================ -->
                <div th:if="${user.provider == null}">
                    <!-- 현재 비밀번호 -->
                    <label>현재 비밀번호 <span class="required">*</span></label>
                    <input type="password" name="currentPassword" id="currentPassword"
                           placeholder="현재 비밀번호를 입력하세요" required>

                    <!-- 새 비밀번호 -->
                    <label>새 비밀번호</label>
                    <div class="password-box">
                        <input type="password" name="newPassword" id="password"
                               placeholder="변경 시에만 입력 (8~20자, 영문+숫자)">
                        <button type="button" class="toggle-btn" id="togglePassword">보기</button>
                    </div>
                    <p id="passwordRuleMsg" class="validation-msg"></p>

                    <!-- 새 비밀번호 확인 -->
                    <label>새 비밀번호 확인</label>
                    <div class="password-box">
                        <input type="password" id="passwordConfirm"
                               placeholder="새 비밀번호 다시 입력">
                    </div>
                    <p id="passwordMatchMsg" class="validation-msg"></p>
                </div>

                <!-- ============================================
                     SNS 계정 안내 (SNS 로그인만)
                ============================================ -->
                <div th:if="${user.provider != null}" class="info-box">
                    <p>💡 소셜 계정은 비밀번호 변경이 불가능합니다.</p>
                    <p>비밀번호 변경은 
                        <span th:text="${user.provider == 'kakao' ? '카카오' : '네이버'}"></span>에서 
                        진행해주세요.
                    </p>
                </div>

                <!-- ============================================
                     기본 정보
                ============================================ -->

                <!-- 이름 -->
                <label>이름 <span class="required">*</span></label>
                <input type="text" th:field="*{name}" id="name" required>

                <!-- 휴대폰 번호 -->
                <label>휴대폰 번호 <span class="required">*</span></label>
                <input type="tel" th:field="*{phone}" id="phone" 
                       placeholder="010-1234-5678" required>

                <!-- ============================================
                     주소 (3단 구성)
                ============================================ -->
                <label>주소 <span class="required">*</span></label>

                <!-- 1) 우편번호 -->
                <div class="inline-input">
                    <input type="text" id="baseAddress" placeholder="우편번호" readonly required>
                    <button type="button" class="check-btn" onclick="openAddressSearch()">주소 검색</button>
                </div>

                <!-- 2) 도로명 주소 -->
                <input type="text" id="roadAddr" placeholder="도로명 주소" readonly>

                <!-- 3) 상세주소 -->
                <input type="text" id="detail" placeholder="상세주소 (건물명/동·호수 등)">

                <!-- hidden: 최종 조립 주소 -->
                <input type="hidden" th:field="*{address}" id="address">

                <!-- hidden: region level -->
                <input type="hidden" th:field="*{regionLevel1}" id="region_level1">
                <input type="hidden" th:field="*{regionLevel2}" id="region_level2">
                <input type="hidden" th:field="*{regionLevel3}" id="region_level3">

                <!-- ============================================
                     프로필 이미지
                ============================================ -->
                <label>프로필 이미지</label>
                <input type="file" name="profileImage" accept="image/*">

                <!-- ============================================
                     제출 버튼
                ============================================ -->
                <button type="submit" class="submit-btn" id="signupBtn">수정 완료</button>

                <!-- 에러 메시지 -->
                <p th:if="${error}" th:text="${error}" class="error-message"></p>
                
                <!-- 성공 메시지 -->
                <p th:if="${successMessage}" th:text="${successMessage}" class="success-message"></p>
            </form>
        </section>
    </main>

    <!-- 공통 푸터 -->
    <div th:replace="layout/footer :: footer"></div>

</body>
</html>