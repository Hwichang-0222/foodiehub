<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<!-- 게시판 목록 페이지 제목 -->
	<title>게시판 | FoodieHub</title>
	<!-- 공통 스타일 시트 -->
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<!-- 게시판 전용 스타일 시트 -->
	<link rel="stylesheet" th:href="@{/css/board.css}">
</head>
<body>

	<!-- 공통 헤더 -->
	<div th:replace="layout/header :: header"></div>

	<!-- 게시판 목록 페이지 메인 콘텐츠 -->
	<main class="board-list-page">

		<!-- 게시판 상단 제목 -->
		<div class="list-header">
			<h1>게시판</h1>
		</div>

		<!-- 게시판 검색 영역 -->
		<div class="search-section">
			<form th:action="@{/board/search}" method="get" class="search-form">
				<select name="category" class="search-category">
					<option value="NOTICE" th:selected="${category == 'NOTICE'}">공지사항</option>
					<option value="GENERAL" th:selected="${category == 'GENERAL'}">일반</option>
					<option value="QUESTION" th:selected="${category == 'QUESTION'}">등급 요청</option>
					<option value="SUGGESTION" th:selected="${category == 'SUGGESTION'}">맛집 추천</option>
				</select>
				<input type="text" name="keyword" class="search-input" placeholder="검색어를 입력하세요" th:value="${keyword}">
				<button type="submit" class="submit-btn">검색</button>
				<button type="reset" class="reset-btn" onclick="location.href='/board/search?category=GENERAL&keyword='">초기화</button>
			</form>
			<a th:if="${user != null}" th:href="@{/board/create}" class="btn btn-create">게시글 작성</a>
		</div>

		<!-- 게시판 카테고리 탭 영역 -->
		<div class="category-tabs">
			<a th:href="@{/board/search(category='NOTICE', keyword=${keyword})}" th:classappend="${category == 'NOTICE'} ? 'active' : ''" class="tab">공지사항</a>
			<a th:href="@{/board/search(category='GENERAL', keyword=${keyword})}" th:classappend="${category == 'GENERAL'} ? 'active' : ''" class="tab">일반</a>
			<a th:href="@{/board/search(category='QUESTION', keyword=${keyword})}" th:classappend="${category == 'QUESTION'} ? 'active' : ''" class="tab">등급 요청</a>
			<a th:href="@{/board/search(category='SUGGESTION', keyword=${keyword})}" th:classappend="${category == 'SUGGESTION'} ? 'active' : ''" class="tab">맛집 추천</a>
		</div>

		<!-- 게시글 총 개수 표시 -->
		<div class="post-count">
			<p>총 <strong th:text="${totalCount}">0</strong>개의 게시글</p>
		</div>

		<!-- 게시글 테이블 -->
		<table class="board-table" th:if="${!#lists.isEmpty(boards) || !#lists.isEmpty(notices)}">
			<thead>
				<tr>
					<th class="col-num">번호</th>
					<th class="col-notice">구분</th>
					<th class="col-title">제목</th>
					<th class="col-author">작성자</th>
					<th class="col-date">작성일</th>
					<th class="col-views">조회</th>
				</tr>
			</thead>
			<tbody>
				<!-- 공지사항 행 -->
				<tr th:each="notice : ${notices}" class="notice-row">
					<td class="col-num">-</td>
					<td class="col-notice"><span class="badge-notice">공지</span></td>
					<td class="col-title"><a th:href="@{/board/detail/{id}(id=${notice.id})}" class="post-link" th:text="${notice.title}"></a></td>
					<td class="col-author" th:text="${notice.userName}"></td>
					<td class="col-date" th:text="${#temporals.format(notice.createdAt, 'yyyy-MM-dd')}"></td>
					<td class="col-views" th:text="${notice.viewCount}"></td>
				</tr>

				<!-- 부모글만 루프 -->
				<th:block th:each="board, boardStat : ${parentPosts}">
					<!-- 부모글 행 -->
					<tr th:classappend="${board.category == 'QUESTION'} ? 'question-row' : 'post-row'">
						<td class="col-num" th:text="${board.displayNumber}"></td>
						<td class="col-notice">
							<span th:if="${board.Category == 'QUESTION'}" class="badge-question">요청</span>
							<span th:if="${board.Category == 'SUGGESTION'}" class="badge-suggestion">추천</span>
							<span th:if="${board.Category == 'GENERAL'}"></span>
						</td>
						<td class="col-title">
							<a th:href="@{/board/detail/{id}(id=${board.id})}" class="post-link" th:text="${board.title}"></a>
						</td>
						<td class="col-author" th:text="${board.userName}"></td>
						<td class="col-date" th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd')}"></td>
						<td class="col-views" th:text="${board.viewCount}"></td>
					</tr>

					<!-- 이 부모글의 답글들 -->
					<tr th:each="reply : ${boards}" th:if="${reply.parentId == board.id}" class="reply-row">
						<td class="col-num" th:text="${reply.displayNumber}"></td>
						<td class="col-notice"><span class="badge-reply">답글</span></td>
						<td class="col-title">
							<div class="reply-indent">
								<span class="indent-arrow">ㄴ</span>
								<a th:href="@{/board/detail/{id}(id=${reply.id})}" class="post-link" th:text="${reply.title}"></a>
							</div>
						</td>
						<td class="col-author" th:text="${reply.userName}"></td>
						<td class="col-date" th:text="${#temporals.format(reply.createdAt, 'yyyy-MM-dd')}"></td>
						<td class="col-views" th:text="${reply.viewCount}"></td>
					</tr>
				</th:block>
			</tbody>
		</table>

		<!-- 게시글이 없을 때 메시지 -->
		<div class="empty-state" th:if="${#lists.isEmpty(boards) && #lists.isEmpty(notices)}">
			<p>등록된 게시글이 없습니다.</p>
		</div>

		<!-- 페이지네이션 (검색 URL 통합) -->
		<div class="pagination" th:if="${totalPages > 1}">
			<!-- 검색 URL로 통합: keyword 없을 때는 빈 문자열로 처리되어 검색 없이 모든 글 표시 -->
			<a th:if="${currentPage > 1}" th:href="@{/board/search(category=${category}, keyword=${keyword}, page=${currentPage - 1})}" class="page-link prev">« 이전</a>
			<a th:each="i : ${#numbers.sequence(1, totalPages)}" 
			   th:href="@{/board/search(category=${category}, keyword=${keyword}, page=${i})}" 
			   th:classappend="${i == currentPage} ? 'active' : ''"
			   class="page-link" th:text="${i}"></a>
			<a th:if="${currentPage < totalPages}" th:href="@{/board/search(category=${category}, keyword=${keyword}, page=${currentPage + 1})}" class="page-link next">다음 »</a>
		</div>

	</main>

	<!-- 공통 푸터 -->
	<div th:replace="layout/footer :: footer"></div>
	
	<script th:inline="javascript">
        /*<![CDATA[*/
		var errorMessage = /*[[${errorMessage}]]*/ null;
        // 에러 메시지 있으면 알림 표시
        if (errorMessage) {
            alert(errorMessage);
        }
        /*]]>*/
	</script>

</body>
</html>