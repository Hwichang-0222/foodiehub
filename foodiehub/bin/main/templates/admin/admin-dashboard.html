<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!-- 관리자 페이지 제목 -->
    <title>관리자 페이지 | FoodieHub</title>
    <!-- 공통 스타일 시트 -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <!-- 관리자 전용 스타일 시트 -->
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <!-- 관리자 대시보드 스크립트 -->
    <script defer th:src="@{/js/admin-dashboard.js}"></script>
</head>
<body>
    
    <!-- 공통 헤더 -->
    <div th:replace="layout/header :: header"></div>

    <!-- 관리자 컨테이너 -->
    <div class="admin-container">
        <!-- 관리자 페이지 제목 -->
        <h1>관리자 페이지</h1>

        <!-- 탭 메뉴 -->
        <div class="tab-menu">
            <!-- 사용자 관리 탭 -->
            <button class="admin-tab active" data-target="#user-tab">사용자 관리</button>
            <!-- 식당 관리 탭 -->
            <button class="admin-tab" data-target="#restaurant-tab">식당 관리</button>
            <!-- 답글 관리 탭 -->
            <button class="admin-tab" data-target="#board-tab">답글 관리</button>
            <!-- 공지사항 관리 탭 -->
            <button class="admin-tab" data-target="#notice-tab">공지사항 관리</button>
        </div>

        <!-- 사용자 관리 탭 -->
        <section id="user-tab" class="tab-content active">
        
            <!-- 검색 폼 -->
            <form th:action="@{/admin/dashboard}" method="get" class="search-form">
                <!-- 탭 정보 전달 -->
                <input type="hidden" name="tab" value="user">
                <!-- 사용자명 또는 이메일 검색 -->
                <input type="text" name="userKeyword" placeholder="이름 또는 이메일 검색" th:value="${keyword}">
                <!-- 상태 필터 전달 -->
                <input type="hidden" name="status" th:value="${status}">
                <!-- 역할 필터 전달 -->
                <input type="hidden" name="role" th:value="${role}">
                <!-- 검색 버튼 -->
                <button type="submit" class="btn">검색</button>
                <!-- 검색 초기화 버튼 -->
                <a th:href="@{/admin/dashboard(tab='user')}" class="reset-btn">검색 초기화</a>
            </form>
        
            <!-- 상태 필터 -->
            <div class="filter-group">
                <div class="filter-left">
                    <!-- 전체 상태 보기 -->
                    <a th:href="@{|/admin/dashboard?tab=user&status=&role=${role}&userKeyword=${keyword}|}"
                       th:classappend="${status == null or status == ''} ? 'active' : ''"
                       class="btn">전체</a>
                    <!-- 활동중 사용자 필터 -->
                    <a th:href="@{|/admin/dashboard?tab=user&status=N&role=${role}&userKeyword=${keyword}|}"
                       th:classappend="${status == 'N'} ? 'active' : ''"
                       class="btn">활동중</a>
                    <!-- 탈퇴한 사용자 필터 -->
                    <a th:href="@{|/admin/dashboard?tab=user&status=Y&role=${role}&userKeyword=${keyword}|}"
                       th:classappend="${status == 'Y'} ? 'active' : ''"
                       class="btn delete">탈퇴회원</a>
                </div>
            
                <!-- 역할(Role) 필터 -->
                <div class="filter-right">
                    <!-- 전체 역할 보기 -->
                    <a th:href="@{|/admin/dashboard?tab=user&role=&status=${status}&userKeyword=${keyword}|}"
                       th:classappend="${role == null or role == ''} ? 'active' : ''"
                       class="btn">전체</a>
                    <!-- 일반 사용자 필터 -->
                    <a th:href="@{|/admin/dashboard?tab=user&role=ROLE_USER&status=${status}&userKeyword=${keyword}|}"
                       th:classappend="${role == 'ROLE_USER'} ? 'active' : ''"
                       class="btn">일반</a>
                    <!-- 가게 사장 필터 -->
                    <a th:href="@{|/admin/dashboard?tab=user&role=ROLE_OWNER&status=${status}&userKeyword=${keyword}|}"
                       th:classappend="${role == 'ROLE_OWNER'} ? 'active' : ''"
                       class="btn">사장</a>
                    <!-- 관리자 필터 -->
                    <a th:href="@{|/admin/dashboard?tab=user&role=ROLE_ADMIN&status=${status}&userKeyword=${keyword}|}"
                       th:classappend="${role == 'ROLE_ADMIN'} ? 'active' : ''"
                       class="btn">관리자</a>
                </div>
            </div>
            
            <!-- 사용자 테이블 -->
            <table class="admin-table">
                <!-- 테이블 헤더 -->
                <thead>
                    <tr>
                        <!-- 번호 -->
                        <th>번호</th>
                        <!-- 이름 -->
                        <th>이름</th>
                        <!-- 이메일 -->
                        <th>이메일</th>
                        <!-- 역할(Role) -->
                        <th>역할 (Role)</th>
                        <!-- 가입일 -->
                        <th>가입일</th>
                        <!-- 현재 상태 -->
                        <th>현재 상태</th>
                        <!-- 관리 버튼 -->
                        <th>관리</th>
                    </tr>
                </thead>
                <!-- 테이블 본문 -->
                <tbody>
                    <!-- 각 사용자 행 -->
                    <tr th:each="user, iStat : ${users}">
                        <!-- 순번 표시 -->
                        <td th:text="${iStat.count}"></td>
                        <!-- 사용자 이름 -->
                        <td th:text="${user.name}"></td>
                        <!-- 사용자 이메일 -->
                        <td th:text="${user.email}"></td>
                        <!-- 역할 선택 드롭다운 -->
                        <td>
                            <!-- 역할 선택 드롭다운 -->
                            <select class="role-select" th:data-user-id="${user.id}">
                                <!-- 일반 사용자 옵션 -->
                                <option value="ROLE_USER"
                                        th:selected="${user.role == 'ROLE_USER'}">사용자</option>
                                <!-- 가게 사장 옵션 -->
                                <option value="ROLE_OWNER"
                                        th:selected="${user.role == 'ROLE_OWNER'}">가게 사장</option>
                                <!-- 관리자 옵션 -->
                                <option value="ROLE_ADMIN"
                                        th:selected="${user.role == 'ROLE_ADMIN'}">ADMIN</option>
                            </select>
                        </td>
                        <!-- 가입일 표시 -->
                        <td th:text="${user.createdAt != null ? #temporals.format(user.createdAt, 'yyyy-MM-dd') : '-'}"></td>
                        <!-- 현재 상태 표시 (활동중/탈퇴) -->
                        <td th:text="${user.isDeleted == 'Y' ? '탈퇴' : '활동중'}"></td>
                        <!-- 관리 버튼 -->
                        <td><button class="btn update-role-btn" type="button">수정</button></td>
                    </tr>
                </tbody>
            </table>
        
            <!-- 페이지네이션 -->
            <div th:if="${userTotalPages > 1 and users.size() > 0}" class="pagination">
                <!-- 이전 버튼 -->
                <a th:if="${userPage > 1}"
                   th:href="@{|/admin/dashboard?tab=user&userPage=${userPage - 1}&userKeyword=${keyword}&status=${status}&role=${role}|}">&laquo; 이전</a>
        
                <!-- 현재 페이지 표시 -->
                <span th:text="'페이지 ' + ${userPage} + ' / ' + ${userTotalPages}"></span>
        
                <!-- 다음 버튼 -->
                <a th:if="${userPage < userTotalPages}"
                   th:href="@{|/admin/dashboard?tab=user&userPage=${userPage + 1}&userKeyword=${keyword}&status=${status}&role=${role}|}">다음 &raquo;</a>
            </div>
        
            <!-- 검색 결과 없음 메시지 -->
            <div th:if="${users.size() == 0}" class="no-result">
                검색 결과가 없습니다.
            </div>
        </section>

        
        <!-- 식당 관리 탭 -->
        <section id="restaurant-tab" class="tab-content"> 
         
            <!-- 식당 검색 영역 -->
            <div class="restaurant-search-area">
                <!-- 검색 폼 -->
                <form th:action="@{/admin/dashboard}" method="get" class="search-form">
                    <!-- 탭 정보 전달 -->
                    <input type="hidden" name="tab" value="restaurant">
                    <!-- 식당명 검색 -->
                    <input type="text" name="restaurantKeyword" placeholder="식당명 검색" th:value="${restaurantKeyword}">
                    <!-- 검색 버튼 -->
                    <button type="submit" class="btn">검색</button>
                    <!-- 검색 초기화 버튼 -->
                    <a th:href="@{/admin/dashboard(tab='restaurant')}" class="reset-btn">검색 초기화</a>
                </form>
			</div>
			 <!-- 식당 필터 영역 -->
            <div class="filter-group">
                <div class="filter-left">
                    <!-- 전체 보기 -->
                    <a th:href="@{/admin/dashboard(tab='restaurant')}" 
                       th:classappend="${ownerFilter == null} ? 'active' : ''" class="btn">전체보기</a>
                    <!-- 오너 있는 식당 필터 -->
                    <a th:href="@{/admin/dashboard(ownerFilter='HAS', tab='restaurant')}" 
                       th:classappend="${ownerFilter == 'HAS'} ? 'active' : ''" class="btn">오너 있는 식당</a>
                    <!-- 오너 없는 식당 필터 -->
                    <a th:href="@{/admin/dashboard(ownerFilter='NONE', tab='restaurant')}" 
                       th:classappend="${ownerFilter == 'NONE'} ? 'active' : ''" class="btn">오너 없는 식당</a>
                </div>
            
            
	            <!-- 식당 추가 버튼 -->
	            <div class="filter-right">
	                <!-- 식당 추가 버튼 -->
	                <a th:href="@{/restaurant/add}" class="btn-create">식당 추가</a>
	            </div>
            </div>
        
            <!-- 식당 테이블 -->
            <table class="admin-table">
                <!-- 테이블 헤더 -->
                <thead>
                    <tr>
                        <!-- 번호 -->
                        <th>번호</th>
                        <!-- 식당명 -->
                        <th>식당명</th>
                        <!-- 오너 -->
                        <th>오너</th>
                        <!-- 주소 -->
                        <th>주소</th>
                        <!-- 지역 -->
                        <th>지역</th>
                        <!-- 카테고리 -->
                        <th>카테고리</th>
                        <!-- 등록일 -->
                        <th>등록일</th>
                        <!-- 관리 버튼 -->
                        <th>관리</th>
                    </tr>
                </thead>
                <!-- 테이블 본문 -->
                <tbody>
                    <!-- 각 식당 행 -->
                    <tr th:each="restaurant, iStat : ${restaurants}">
                        <!-- 순번 표시 -->
                        <td th:text="${iStat.count}"></td>
                        <!-- 식당명 -->
                        <td th:text="${restaurant.name}"></td>
                        <!-- 오너명 또는 미지정 표시 -->
                        <td th:text="${restaurant.ownerName != null ? restaurant.ownerName : '미지정'}"></td>
                        <!-- 식당 주소 -->
                        <td th:text="${restaurant.address}"></td>
                        <!-- 식당 지역 -->
                        <td th:text="${restaurant.region}"></td>
                        <!-- 식당 카테고리 -->
                        <td th:text="${restaurant.category}"></td>
                        <!-- 등록일 표시 -->
                        <td th:text="${#temporals.format(restaurant.createdAt, 'yyyy-MM-dd')}"></td>
                        <!-- 관리 버튼 -->
                        <td>
                            <!-- 상세 보기 버튼 -->
                            <a th:href="@{/restaurant/detail/{id}(id=${restaurant.id})}" class="btn">보기</a>
                            <!-- 수정 버튼 -->
                            <a th:href="@{/restaurant/edit/{id}(id=${restaurant.id})}" class="btn">수정</a>
                            <!-- 삭제 버튼 -->
                            <a th:href="@{/restaurant/delete/{id}(id=${restaurant.id})}" class="btn delete">삭제</a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- 식당 페이지네이션 -->
            <div class="pagination">
                <!-- 이전 버튼 -->
                <a th:if="${restaurantPage > 1}" 
                   th:href="@{/admin/dashboard(restaurantPage=${restaurantPage - 1}, tab='restaurant')}">&laquo; 이전</a>
        
                <!-- 현재 페이지 표시 -->
                <span th:text="' 페이지 ' + ${restaurantPage} + ' / ' + ${restaurantTotalPages}"></span>
        
                <!-- 다음 버튼 -->
                <a th:if="${restaurantPage < restaurantTotalPages}" 
                   th:href="@{/admin/dashboard(restaurantPage=${restaurantPage + 1}, tab='restaurant')}">다음 &raquo;</a>
            </div>

        </section>

        <!-- 답글 관리 탭 -->
        <section id="board-tab" class="tab-content">
        
            <!-- 답글 필터 -->
            <div class="filter-form">
                <!-- 전체 보기 -->
                <a th:href="@{/admin/dashboard(tab='board')}" 
                   th:classappend="${filter == null} ? 'active' : ''" class="btn">전체보기</a>
                <!-- 등급요청 필터 -->
                <a th:href="@{/admin/dashboard(tab='board', filter='QUESTION')}" 
                   th:classappend="${filter == 'QUESTION'} ? 'active' : ''" class="btn">등급</a>
                <!-- 추천 필터 -->
                <a th:href="@{/admin/dashboard(tab='board', filter='SUGGESTION')}" 
                   th:classappend="${filter == 'SUGGESTION'} ? 'active' : ''" class="btn">추천</a>
            </div>
            
            <!-- 미답변 요청 테이블 -->
            <table class="admin-table">
                <!-- 테이블 헤더 -->
                <thead>
                    <tr>
                        <!-- 번호 -->
                        <th>번호</th>
                        <!-- 제목 -->
                        <th>제목</th>
                        <!-- 작성자 -->
                        <th>작성자</th>
                        <!-- 카테고리 -->
                        <th>카테고리</th>
                        <!-- 작성일 -->
                        <th>작성일</th>
                        <!-- 관리 버튼 -->
                        <th>관리</th>
                    </tr>
                </thead>
                <!-- 테이블 본문 -->
                <tbody>
                    <!-- 각 미답변 요청 행 -->
                    <tr th:each="post, iStat : ${boards}">
                        <!-- 순번 표시 -->
                        <td th:text="${iStat.count}"></td>
                        <!-- 게시글 제목 -->
                        <td th:text="${post.title}"></td>
                        <!-- 게시글 작성자 -->
                        <td th:text="${post.userName}"></td>
                        <!-- 게시글 카테고리 -->
                        <td th:text="${post.category == 'SUGGESTION' ? '맛집 추천' : '등급 요청'}"></td>
                        <!-- 게시글 작성일 -->
                        <td th:text="${post.createdAt != null ? #temporals.format(post.createdAt, 'yyyy-MM-dd') : '-'}"></td>
                        <!-- 관리 버튼 -->
                        <td>
                            <!-- 보기 버튼 -->
                            <a th:href="@{/board/detail/{id}(id=${post.id})}" class="btn">보기</a>
                            <!-- 답글 작성 버튼 -->
                            <button type="button" class="btn reply-btn" th:data-post-id="${post.id}" th:data-post-title="${post.title}">답글</button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- 답글 관리 페이지네이션 -->
            <div class="pagination">
                <!-- 이전 버튼 -->
                <a th:if="${boardPage > 1}" 
                   th:href="@{/admin/dashboard(boardPage=${boardPage - 1}, tab='board')}">&laquo; 이전</a>
        
                <!-- 현재 페이지 표시 -->
                <span th:text="'페이지 ' + ${boardPage} + ' / ' + ${boardTotalPages}"></span>
        
                <!-- 다음 버튼 -->
                <a th:if="${boardPage < boardTotalPages}" 
                   th:href="@{/admin/dashboard(boardPage=${boardPage + 1}, tab='board')}">다음 &raquo;</a>
            </div>

            <!-- 답글 작성 모달 -->
            <div id="reply-modal" class="modal" style="display:none;">
                <!-- 모달 콘텐츠 -->
                <div class="modal-content">
                    <!-- 모달 헤더 -->
                    <div class="modal-header">
                        <!-- 모달 제목 -->
                        <h3>답글 작성</h3>
                        <!-- 모달 닫기 버튼 -->
                        <button type="button" class="modal-close" onclick="closeReplyModal()">×</button>
                    </div>
                    <!-- 답글 작성 폼 -->
                    <form id="reply-form" method="post" th:action="@{/admin/reply}">
                        <!-- 부모 게시글 ID -->
                        <input type="hidden" name="parentId" id="reply-parent-id" value="">
                        
                        <!-- 제목 입력 -->
                        <div class="form-group">
                            <!-- 제목 레이블 -->
                            <label for="reply-title" class="form-label">제목</label>
                            <!-- 제목 입력 필드 -->
                            <input type="text" id="reply-title" name="title" class="form-control" placeholder="제목을 입력하세요" required>
                        </div>

                        <!-- 내용 입력 -->
                        <div class="form-group">
                            <!-- 내용 레이블 -->
                            <label for="reply-content" class="form-label">내용</label>
                            <!-- 내용 입력 텍스트영역 -->
                            <textarea id="reply-content" name="content" class="form-control form-textarea" placeholder="내용을 입력하세요" required rows="8"></textarea>
                        </div>

                        <!-- 폼 액션 버튼 -->
                        <div class="form-actions">
                            <!-- 작성 버튼 -->
                            <button type="submit" class="btn-submit">작성</button>
                            <!-- 취소 버튼 -->
                            <button type="button" class="btn-cancel" onclick="closeReplyModal()">취소</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- 공지사항 관리 탭 -->
        <section id="notice-tab" class="tab-content">
        
            <!-- 공지사항 관리 헤더 -->
            <div class="notice-header">
                <!-- 공지사항 작성 버튼 -->
                <a th:href="@{/admin/notice/create}" class="btn-create">공지 작성</a>
            </div>
            <!-- 공지사항 테이블 -->
            <table class="admin-table">
                <!-- 테이블 헤더 -->
                <thead>
                    <tr>
                        <!-- 번호 -->
                        <th>번호</th>
                        <!-- 제목 -->
                        <th>제목</th>
                        <!-- 작성일 -->
                        <th>작성일</th>
                        <!-- 관리 버튼 -->
                        <th>관리</th>
                    </tr>
                </thead>
                <!-- 테이블 본문 -->
                <tbody>
                    <!-- 각 공지사항 행 -->
                    <tr th:each="notice, iStat : ${notices}">
                        <!-- 순번 표시 -->
                        <td th:text="${iStat.count}"></td>
                        <!-- 공지사항 제목 -->
                        <td th:text="${notice.title}"></td>
                        <!-- 공지사항 작성일 -->
                        <td th:text="${notice.createdAt != null ? #temporals.format(notice.createdAt, 'yyyy-MM-dd') : '-'}"></td>
                        <!-- 관리 버튼 -->
                        <td>
                            <!-- 수정 버튼 -->
                            <a th:href="@{/admin/notice/edit/{id}(id=${notice.id})}" class="btn">수정</a>
                            <!-- 삭제 버튼 -->
                            <a th:href="@{/admin/notice/delete/{id}(id=${notice.id})}" class="btn delete">삭제</a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- 공지사항 페이지네이션 -->
            <div class="pagination">
                <!-- 이전 버튼 -->
                <a th:if="${noticePage > 1}" 
                   th:href="@{/admin/dashboard(noticePage=${noticePage - 1}, tab='notice')}">&laquo; 이전</a>
        
                <!-- 현재 페이지 표시 -->
                <span th:text="'페이지 ' + ${noticePage} + ' / ' + ${noticeTotalPages}"></span>
        
                <!-- 다음 버튼 -->
                <a th:if="${noticePage < noticeTotalPages}" 
                   th:href="@{/admin/dashboard(noticePage=${noticePage + 1}, tab='notice')}">다음 &raquo;</a>
            </div>
        </section>
    </div>
    
    <!-- 공통 푸터 -->
    <div th:replace="layout/footer :: footer"></div>
    
    <!-- 성공/오류 메시지 출력 스크립트 -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        // 성공 메시지 변수
        var successMessage = /*[[${successMessage}]]*/ null;
        // 성공 메시지 있으면 알림 표시
        if (successMessage) {
            alert(successMessage);
        }
        /*]]>*/
    </script>
</body>
</html>