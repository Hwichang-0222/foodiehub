<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${restaurant.name} + ' - ìƒì„¸ ì •ë³´'">ë§›ì§‘ ìƒì„¸</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	
	<!-- ê³µí†µ í—¤ë” -->
	<div th:replace="layout/header :: header"></div>

	<div class="restaurant-detail">

	    <!-- ì™¼ìª½: ì´ë¯¸ì§€ + ê¸°ë³¸ ì •ë³´ -->
	    <div class="detail-left">
	        <img th:src="${restaurant.mainImageUrl}" alt="ëŒ€í‘œ ì´ë¯¸ì§€">
	        <div class="basic-info">
	            <h2 th:text="${restaurant.name}"></h2>
	            <p><strong>ì¹´í…Œê³ ë¦¬:</strong> <span th:text="${restaurant.category}"></span></p>
	            <p><strong>ì§€ì—­:</strong> <span th:text="${restaurant.region}"></span></p>
	            <p><strong>ì£¼ì†Œ:</strong> <span th:text="${restaurant.address}"></span></p>
	            <div class="stats">
	                â­ í‰ê·  ë³„ì : <span th:text="${restaurant.avgRating}">0.0</span><br>
	                ğŸ’¬ ë¦¬ë·° ìˆ˜: <span th:text="${restaurant.reviewCount}">0</span>
	            </div>
	        </div>
	    </div>
	
	    <!-- ì˜¤ë¥¸ìª½: íƒ­ êµ¬ì¡° -->
	    <div class="detail-right">
	        <div class="tabs">
	            <div class="tab active" data-tab="detail">ìƒì„¸</div>
		        <div class="tab" data-tab="reviews">ë¦¬ë·°</div>
		        <div class="tab" data-tab="write">ë¦¬ë·°ì‘ì„±</div>
		        <div class="tab" data-tab="gallery">ì´ë¯¸ì§€</div>
		        <div class="tab" data-tab="map">ì§€ë„</div>
	        </div>
	
			<!-- ìƒì„¸ -->
		    <div id="detail" class="tab-content active">
		        <div class="detail-box">
		            <h3>ê°€ê²Œ ì„¤ëª…</h3>
		            <p th:text="${restaurant.description}">ì‹ë‹¹ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
		            <hr>
		            <p><strong>ì£¼ì†Œ:</strong> <span th:text="${restaurant.address}"></span></p>
		            <p><strong>ì§€ì—­:</strong> <span th:text="${restaurant.region}"></span></p>
		            <p><strong>ì¹´í…Œê³ ë¦¬:</strong> <span th:text="${restaurant.category}"></span></p>
		        </div>
		    </div>
		
		    <!-- ë¦¬ë·° -->
		    <div id="reviews" class="tab-content">
		        <div th:if="${#lists.isEmpty(reviews)}">
		            <p>ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
		        </div>
		        <div th:each="review : ${reviews}" class="review-card">
		            <p th:text="${review.content}"></p>
		            <small th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}"></small>
		        </div>
		    </div>
		
		    <!-- ë¦¬ë·° ì‘ì„± -->
		    <div id="write" class="tab-content">
		        <form th:action="@{/review/write}" method="post" enctype="multipart/form-data">
		            <input type="hidden" name="restaurantId" th:value="${restaurant.id}">
		            <div class="review-form">
		                <label>ë³„ì </label>
		                <select name="rating" required>
		                    <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
		                    <option value="4">â˜…â˜…â˜…â˜…â˜†</option>
		                    <option value="3">â˜…â˜…â˜…â˜†â˜†</option>
		                    <option value="2">â˜…â˜…â˜†â˜†â˜†</option>
		                    <option value="1">â˜…â˜†â˜†â˜†â˜†</option>
		                </select>
		
		                <label>ë¦¬ë·° ë‚´ìš©</label>
		                <textarea name="content" rows="5" placeholder="ë¦¬ë·°ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
		                
		                <label>ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
						<input type="file" name="files" multiple accept="image/*">
		                
		                <button type="submit" class="submit-btn">ë“±ë¡í•˜ê¸°</button>
		            </div>
		        </form>
		    </div>
		
		    <!-- ì´ë¯¸ì§€ -->
		    <div id="gallery" class="tab-content">
		        <div th:if="${#lists.isEmpty(images)}">
		            <p>ë“±ë¡ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
		        </div>
		        <div class="gallery">
		            <img th:each="img : ${images}" th:src="${img.fileUrl}" alt="ë¦¬ë·° ì´ë¯¸ì§€">
		        </div>
		    </div>
		
		    <!-- ì§€ë„ -->
		    <div id="map" class="tab-content"></div>
		</div>
	</div>

	<!-- ê³µí†µ í‘¸í„° -->
    <div th:replace="layout/footer :: footer"></div>

	<!-- ë„¤ì´ë²„ ì§€ë„ SDK -->
	<script 
	    type="text/javascript"
	    src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=n7nbab23et">
	</script>
	
	<!-- íƒ­ ì „í™˜ + ì§€ë„ ë Œë”ë§ -->
	<script type="text/javascript">
	    const tabs = document.querySelectorAll('.tab');
	    const contents = document.querySelectorAll('.tab-content');
	
	    tabs.forEach(tab => {
	        tab.addEventListener('click', () => {
	            tabs.forEach(t => t.classList.remove('active'));
	            contents.forEach(c => c.classList.remove('active'));
	            tab.classList.add('active');
	            document.getElementById(tab.dataset.tab).classList.add('active');
	
	            // ì§€ë„ íƒ­ í´ë¦­ ì‹œ ì§€ë„ ë Œë”ë§
	            if (tab.dataset.tab === 'map') {
	                initMap();
	            }
	        });
	    });
	</script>
	
	<!-- ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜ -->
	<script th:inline="javascript" type="text/javascript">
	    function initMap() {
	        const lat = [[${restaurant.latitude}]];
	        const lng = [[${restaurant.longitude}]];
	        const name = /*[[${restaurant.name}]]*/ 'ì‹ë‹¹ëª…';
	
	        const map = new naver.maps.Map('map', {
	            center: new naver.maps.LatLng(lat, lng),
	            zoom: 16,
	            zoomControl: true,
	            mapTypeControl: true
	        });
	
	        const marker = new naver.maps.Marker({
	            position: new naver.maps.LatLng(lat, lng),
	            map: map,
	            title: name
	        });
	
	        const infoWindow = new naver.maps.InfoWindow({
	            content: `<div style="padding:10px;font-size:14px;">
	                        <b>${name}</b><br>
	                        ìœ„ë„: ${lat.toFixed(4)}, ê²½ë„: ${lng.toFixed(4)}
	                      </div>`
	        });
	
	        // ë§ˆì»¤ í´ë¦­ ì‹œ ë§í’ì„  ì—´ê¸°
	        naver.maps.Event.addListener(marker, 'click', () => {
	            infoWindow.open(map, marker);
	        });
	
	        // íƒ­ ì „í™˜ í›„ ì§€ë„ ë¦¬ì‚¬ì´ì¦ˆ
	        setTimeout(() => { naver.maps.Event.trigger(map, 'resize'); }, 300);
	    }
	</script>
</body>
</html>
