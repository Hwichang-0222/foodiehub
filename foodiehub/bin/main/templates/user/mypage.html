<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마이페이지 | FoodieHub</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

    <div th:replace="layout/header :: header"></div>

    <main class="mypage-main">
        <div class="mypage-container">

            <!-- 왼쪽: 프로필 -->
            <section class="mypage-left">
                <div class="mypage-profile">
                    <img th:src="${user.profileImageUrl != null ? user.profileImageUrl : '/images/default-profile.png'}"
                         alt="프로필 이미지" class="mypage-profile-img">
                    <h3 th:text="${user.name}"></h3>
                </div>

                <div class="mypage-info">
                    <p><strong>이메일:</strong> <span th:text="${user.email}"></span></p>
                    <p><strong>전화번호:</strong> <span th:text="${user.phone}"></span></p>
                    <p><strong>주소:</strong> <span th:text="${user.address}"></span></p>
                    <p><strong>생년월일:</strong>
                        <span th:text="${#temporals.format(user.birthDate, 'yyyy-MM-dd')}"></span></p>
                    <p><strong>성별:</strong>
                        <span th:text="${user.gender == 'M' ? '남성' : (user.gender == 'F' ? '여성' : '기타')}"></span>
                    </p>
                </div>

                <div class="mypage-actions">
                    <a href="/user/edit" class="edit-btn">정보 수정</a>
                    <form th:action="@{/user/delete}" method="post" onsubmit="return confirm('정말 탈퇴하시겠습니까?');">
                        <button type="submit" class="delete-btn">회원 탈퇴</button>
                    </form>
                </div>
            </section>

            <!-- 오른쪽: 탭 -->
            <section class="mypage-right">
                <div class="tab-menu">
                    <button class="tab-btn" data-tab="reviews">내가 쓴 리뷰</button>
                    <button class="tab-btn" data-tab="boards">내가 쓴 게시글</button>
                </div>

                <!-- 리뷰 탭 -->
				<div id="reviews" class="tab-content">
				    <div class="tab-content-header">
				        <h3>내가 쓴 리뷰</h3>
				        <p class="review-count"
				           th:text="'총 ' + (${totalReviews != null} ? ${totalReviews} : 0) + '개의 리뷰를 작성했습니다.'"></p>
				    </div>
				
				    <div th:if="${#lists.isEmpty(reviews)}" class="empty-box">
				        <p>작성한 리뷰가 없습니다.</p>
				    </div>
				
				    <div class="scroll-list">
				        <a th:each="r : ${reviews}"
				           th:href="@{'/review/detail/' + ${r.id}}"
				           class="item-card">
				            <p class="item-title" th:text="${r.restaurantName}"></p>
				            <p class="item-content" th:text="${r.content}"></p>
				            <small th:text="${#temporals.format(r.createdAt, 'yyyy-MM-dd HH:mm')}"></small>
				        </a>
				    </div>
				
				    <div class="pagination" th:if="${reviewTotalPages > 1}">
				        <a th:if="${reviewCurrentPage > 1}"
				           th:href="@{/user/mypage(reviewPage=${reviewCurrentPage - 1}, boardPage=${boardCurrentPage})}">이전</a>
				        <span th:text="${reviewCurrentPage} + ' / ' + ${reviewTotalPages}"></span>
				        <a th:if="${reviewCurrentPage < reviewTotalPages}"
				           th:href="@{/user/mypage(reviewPage=${reviewCurrentPage + 1}, boardPage=${boardCurrentPage})}">다음</a>
				    </div>
				</div>
				
				<!-- 게시글 탭 -->
				<div id="boards" class="tab-content">
				    <div class="tab-content-header">
				        <h3>내가 쓴 게시글</h3>
				        <p class="review-count"
				           th:text="'총 ' + (${totalBoards != null} ? ${totalBoards} : 0) + '개의 게시글을 작성했습니다.'"></p>
				    </div>
				
				    <div th:if="${#lists.isEmpty(boards)}" class="empty-box">
				        <p>작성한 게시글이 없습니다.</p>
				    </div>
				
				    <div class="scroll-list">
				        <a th:each="b : ${boards}"
				           th:href="@{'/board/detail/' + ${b.id}}"
				           class="item-card">
				            <p class="item-title" th:text="${b.title}"></p>
				            <p class="item-content" th:text="${b.content}"></p>
				            <small th:text="${#temporals.format(b.createdAt, 'yyyy-MM-dd HH:mm')}"></small>
				        </a>
				    </div>
				
				    <div class="pagination" th:if="${boardTotalPages > 1}">
				        <a th:if="${boardCurrentPage > 1}"
				           th:href="@{/user/mypage(reviewPage=${reviewCurrentPage}, boardPage=${boardCurrentPage - 1})}">이전</a>
				        <span th:text="${boardCurrentPage} + ' / ' + ${boardTotalPages}"></span>
				        <a th:if="${boardCurrentPage < boardTotalPages}"
				           th:href="@{/user/mypage(reviewPage=${reviewCurrentPage}, boardPage=${boardCurrentPage + 1})}">다음</a>
				    </div>
				</div>
            </section>
        </div>
    </main>

    <div th:replace="layout/footer :: footer"></div>

    <script>
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }

        // 렌더링 완료 후 한 프레임 뒤에 스크롤 0 고정
        window.addEventListener("load", () => {
            requestAnimationFrame(() => {
                window.scrollTo({ top: 0, left: 0, behavior: "auto" });
            });
        });

        document.addEventListener("DOMContentLoaded", function() {
            const tabBtns = document.querySelectorAll(".tab-btn");
            const tabContents = document.querySelectorAll(".tab-content");

            function activateTab(tabId) {
                tabBtns.forEach(btn => btn.classList.toggle("active", btn.dataset.tab === tabId));
                tabContents.forEach(content => content.classList.toggle("active", content.id === tabId));
                history.replaceState(null, "", "#" + tabId);
                window.scrollTo({ top: 0, behavior: "smooth" });
            }

            tabBtns.forEach(btn => {
                btn.addEventListener("click", () => activateTab(btn.dataset.tab));
            });

            const currentHash = window.location.hash.replace("#", "");
            activateTab(currentHash || "reviews");

            // 페이지네이션 클릭 시 상단 이동
            document.querySelectorAll(".pagination a").forEach(a => {
                a.addEventListener("click", () => {
                    window.scrollTo({ top: 0, behavior: "smooth" });
                });
            });
        });
    </script>

</body>
</html>
